<!DOCTYPE html><html lang="en-us" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>CTFd-docker-compose-template | Zedsich's Blog</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy","copyFinish":"copied","expand":"expand"}}</script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link rel="stylesheet" href="/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem"><a class="navBlock" href="/about/"><span class="navItemTitle">About</span></a></li><li class="navItem"><a class="navBlock" href="/contact/"><span class="navItemTitle">Contact</span></a></li><li class="navItem"><a class="navBlock" href="/friends/"><span class="navItemTitle">Friends</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>CTFd-docker-compose-template</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2024-04-28T05:32:31.000Z" id="date"> 2024-04-28</time></div></span><br><span>Last Update: <div class="control"><time datetime="2024-05-17T07:17:31.391Z" id="updated"> 2024-05-17</time></div></span><br><span>Word Count: <div class="control">2.1k</div></span><br><span>Read Time: <div class="control">11 min</div></span></div></div><hr><div id="post-content"><h1 id="CTFd-多服务-WEB-dynamic-docker-compose-task实现"><a href="#CTFd-多服务-WEB-dynamic-docker-compose-task实现" class="headerlink" title="CTFd 多服务 WEB dynamic docker compose task实现"></a>CTFd 多服务 WEB dynamic docker compose task实现</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一年前在出多服务web题时候的想法是，把一个服务当做基础的docker0，在这个docker里再塞一个docker1，在docker1中实现第二个服务，但是考虑到嵌套的性能和docker network的各种原因最后放弃了。</p>
<p>前阵子我们在主站上新加了<code>CTFd-owl</code>，使得docker-compose成为了可能。直接把两个服务塞进docker-compose里，但等到部署的时候发现了一个问题，包括<code>CTFd-whale</code>和<code>CTFd-owl</code>在内的动态容器插件，大多都只能映射出来一个随机端口，但如果多个服务都需要对外暴露怎么办？在各种尝试之下完成了下面这个不用再次魔改插件的<code>dynamic-docker-compose-task</code>板子</p>
<h2 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h2><ul>
<li><code>CTFd 3.5.3</code></li>
<li><code>CTFd-owl</code></li>
</ul>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>首先我们需要明确需要扔进<code>docker-compose</code>的服务有哪些，在这里我用的是<code>python</code>+<code>mysql</code>+<code>ChatGPT-Next-Web</code>的组合，也是一个简单的ssrf的题目</p>
<p><img src="\img\docker-compose-template\framework.png" alt="framework"></p>
<p><code>scr1wgpt</code>使用的是<code>ChatGPT-Next-Web</code>的<code>2.11.2</code>版本，但是进行了细微的魔改，这个之后再说，在这里需要一些trick来部署</p>
<p><code>scr1wgpt-web</code>使用的是基础<code>python+flask</code>，没什么多余的东西。在这里作为基础服务</p>
<p><code>scr1wgpt-mysql</code>使用的也是基础<code>mysql</code>，但是同样需要进行一些调整</p>
<p><code>scr1wgpt-nginx</code>需要提前将<code>nginx.conf</code>放进docker中，来做反代</p>
<h3 id="为什么要使用nginx"><a href="#为什么要使用nginx" class="headerlink" title="为什么要使用nginx"></a>为什么要使用nginx</h3><p>一方面是，web和gpt两个服务都需要暴露端口，但是在不修改插件的前提下很难做到，所以需要用nginx做反代，这里是将scr1wgpt-web作为基础的服务，不用做什么修改，而将<code>scr1wgpt</code>这个服务扔到<code>/chat</code>路由下</p>
<h3 id="scr1wgpt"><a href="#scr1wgpt" class="headerlink" title="scr1wgpt"></a>scr1wgpt</h3><p>由于我们把整个服务的都扔到了<code>/chat</code>的路由，所以需要对<code>/#/auth</code>，<code>/#/setting</code>等路径进行转换，全部转换成<code>/chat/#/...</code>编译后重新打包成一个镜像即可，这里是<code>shiraikuroko/gpt</code></p>
<h3 id="scr1wgpt-web"><a href="#scr1wgpt-web" class="headerlink" title="scr1wgpt-web"></a>scr1wgpt-web</h3><p><code>app.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, redirect, url_for, session<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><span class="hljs-keyword">from</span> sqlalchemy.engine.url <span class="hljs-keyword">import</span> make_url<br><span class="hljs-keyword">import</span> pymysql.cursors<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">from</span> flask_limiter <span class="hljs-keyword">import</span> Limiter<br><span class="hljs-keyword">from</span> flask_limiter.util <span class="hljs-keyword">import</span> get_remote_address<br><br>app = Flask(__name__)<br>app.secret_key = os.urandom(<span class="hljs-number">64</span>)<br><span class="hljs-comment"># limiter = Limiter(</span><br><span class="hljs-comment">#     app=app,</span><br><span class="hljs-comment">#     key_func=get_remote_address,  # 使用客户端IP作为限制的键</span><br><span class="hljs-comment">#     default_limits=[&quot;5 per minute&quot;]  # 默认限制，每分钟最多5次请求</span><br><span class="hljs-comment"># )</span><br><br><span class="hljs-comment"># 等待数据库初始化上线</span><br>url = make_url(<span class="hljs-string">&quot;mysql+pymysql://root:sssctf2024_rootpassword@scr1wgpt-mysql/sssctf2024_db&quot;</span>)<br>url.database = <span class="hljs-literal">None</span><br>engine = create_engine(url)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;等待数据库就绪。。。&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>, flush=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        engine.raw_connection()<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;。&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>, flush=<span class="hljs-literal">True</span>)<br>        time.sleep(<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>, flush=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># MySQL 连接配置</span><br>conn = pymysql.connect(<br>    host=<span class="hljs-string">&#x27;scr1wgpt-mysql&#x27;</span>,<br>    user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>    password=<span class="hljs-string">&#x27;sssctf2024_rootpassword&#x27;</span>,<br>    database=<span class="hljs-string">&#x27;sssctf2024_db&#x27;</span>,<br>    cursorclass=pymysql.cursors.DictCursor<br>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-comment"># @limiter.limit(&quot;10 per minute&quot;)  # Limits to 10 login attempts per minute</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    msg = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br><br>        waf = [<span class="hljs-string">&#x27;or&#x27;</span>, <span class="hljs-string">&#x27;and&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;0b&#x27;</span>, <span class="hljs-string">&#x27;0o&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;outfile&#x27;</span>, <span class="hljs-string">&#x27;load_file&#x27;</span>, <span class="hljs-string">&#x27;terminated&#x27;</span>, <span class="hljs-string">&#x27;field&#x27;</span>]<br>        ulow = username.lower()<br>        plow = password.lower()<br>        <span class="hljs-keyword">for</span> waff <span class="hljs-keyword">in</span> waf:<br>            <span class="hljs-keyword">if</span> waff <span class="hljs-keyword">in</span> ulow <span class="hljs-keyword">or</span> waff <span class="hljs-keyword">in</span> plow:<br>                msg = <span class="hljs-string">&quot;Login failed!&quot;</span><br>                <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;login.html&#x27;</span>, msg=msg)<br><br>        cur = conn.cursor()<br>        query = <span class="hljs-string">f&quot;SELECT * FROM sssctf2024_users WHERE username=&#x27;<span class="hljs-subst">&#123;username&#125;</span>&#x27; AND password=&#x27;<span class="hljs-subst">&#123;password&#125;</span>&#x27; LIMIT 0,1&quot;</span><br><br>        <span class="hljs-keyword">try</span>:<br>            cur.execute(query)     <span class="hljs-comment"># 执行SQL查询</span><br>            result = cur.fetchall()         <span class="hljs-comment"># 获取所有结果</span><br>            <span class="hljs-keyword">if</span> result:<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (username == <span class="hljs-string">&#x27;Scr1w_admin&#x27;</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">&#x27;sssctf2024_P@ssvv0rd&#x27;</span>):<br>                    msg = <span class="hljs-string">&#x27;Login failed!&#x27;</span><br>                    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;login.html&#x27;</span>, msg=msg)<br><br>                session[<span class="hljs-string">&#x27;username&#x27;</span>] = username  <span class="hljs-comment"># 将用户名存储在会话中</span><br>                <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;options&#x27;</span>))<br>            <span class="hljs-keyword">else</span>:<br>                msg = <span class="hljs-string">&#x27;Login failed!&#x27;</span><br><br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> error:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;An error occurred: <span class="hljs-subst">&#123;error&#125;</span>&quot;</span>, flush=<span class="hljs-literal">True</span>)<br>            msg = <span class="hljs-string">&#x27;Login failed!&#x27;</span><br><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;login.html&#x27;</span>, msg=msg)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/options&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">options</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> session:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;options.html&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_scr1wgpt_ip</span>():<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> socket.gethostbyname(<span class="hljs-string">&#x27;scr1wgpt&#x27;</span>)<br>    <span class="hljs-keyword">except</span> socket.gaierror:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/generator&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    scr1wgpt_ip = get_scr1wgpt_ip()<br>    <span class="hljs-keyword">if</span> scr1wgpt_ip <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Unable to resolve scr1wgpt domain&#x27;</span><br>    <span class="hljs-keyword">if</span> request.remote_addr != scr1wgpt_ip:<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;generator.html&#x27;</span>, message=<span class="hljs-string">&#x27;Remote test flag has been generated:\nSsS(tF&#123;f@k3_f|4g_l-lAl-lA]&#x27;</span>)<br>    flag_value = os.getenv(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">&#x27;Flag not set&#x27;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;generator.html&#x27;</span>, message=<span class="hljs-string">&quot;Local flag has been generated:\n&quot;</span> + flag_value)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-string">&#x27;80&#x27;</span>)<br><br><br></code></pre></td></tr></table></figure>
<p><code>Dockerfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.9</span>-slim-buster<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./templates /app/templates</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./app.py /app/app.py</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./requirements.txt /app/requirements.txt</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&quot;s|http://deb.debian.org/debian|https://mirror.sjtu.edu.cn/debian|g&quot;</span> /etc/apt/sources.list \</span><br><span class="language-bash">    &amp;&amp; apt-get update \</span><br><span class="language-bash">    &amp;&amp; apt-get install -y --no-install-recommends \</span><br><span class="language-bash">        build-essential \</span><br><span class="language-bash">        libffi-dev \</span><br><span class="language-bash">        libssl-dev \</span><br><span class="language-bash">    &amp;&amp; apt-get clean \</span><br><span class="language-bash">    &amp;&amp; <span class="hljs-built_in">rm</span> -rf /var/lib/apt/lists/* </span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><br></code></pre></td></tr></table></figure>
<p>不用做其他的适配，wp可以看后面的链接</p>
<h3 id="scr1wgpt-mysql"><a href="#scr1wgpt-mysql" class="headerlink" title="scr1wgpt-mysql"></a>scr1wgpt-mysql</h3><p>在这里遇到过很多坑，也是这个地方修的最久，数据库的初始化一直有问题，猜测是由于服务器性能不行，mysql的容器启动太久，导致初始化有问题，所以这里选择了另一种方式</p>
<p><code>init.sql</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS sssctf2024_db;<br><br>USE sssctf2024_db;<br><br>CREATE TABLE IF NOT EXISTS sssctf2024_users (<br>    id INT AUTO_INCREMENT PRIMARY KEY,<br>    username VARCHAR(255) NOT NULL,<br>    password VARCHAR(255) NOT NULL<br>);<br><br>INSERT INTO sssctf2024_users (username, password) VALUES (&#x27;Scr1w_admin&#x27;, &#x27;sssctf2024_P@ssvv0rd&#x27;);<br><br></code></pre></td></tr></table></figure>
<p><code>SQLDocketfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> mysql:latest<br><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./init.sql /docker-entrypoint-initdb.d/</span><br><br></code></pre></td></tr></table></figure>
<h3 id="scr1wgpt-nginx"><a href="#scr1wgpt-nginx" class="headerlink" title="scr1wgpt-nginx"></a>scr1wgpt-nginx</h3><p>这里的nginx是最关键的一部分，需要把整个gpt的服务都放到<code>/chat</code>这个路由下</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">worker_processes</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">1024</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">sendfile</span> <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">upstream</span> web_backend &#123;<br>        <span class="hljs-attribute">server</span> scr1wgpt-web;<br>    &#125;<br><br>    <span class="hljs-section">upstream</span> chat_backend &#123;<br>        <span class="hljs-attribute">server</span> scr1wgpt:<span class="hljs-number">3000</span>;<br>    &#125;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://web_backend;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /chat &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/#/chat;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /_next &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend<span class="hljs-variable">$request_uri</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /serviceWorkerRegister.js &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/serviceWorkerRegister.js;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /site.webmanifest &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/site.webmanifest;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /serviceWorker.js &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/serviceWorker.js;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /favicon.ico &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/favicon.ico;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /api &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend<span class="hljs-variable">$request_uri</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /prompts.json &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend/prompts.json;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /google-fonts &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://chat_backend<span class="hljs-variable">$request_uri</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>但是这里又出了同样的问题，初始化复制进去大概率访问不到，所以还是需要提前打包</p>
<p><code>Dockerfile</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">worker_processes <span class="hljs-number">1</span>;<br><br>events &#123;<br>    worker_connections <span class="hljs-number">1024</span>;<br>&#125;<br><br>http &#123;<br>    sendfile on;<br><br>    upstream web_backend &#123;<br>        server scr1wgpt-web;<br>    &#125;<br><br>    upstream chat_backend &#123;<br>        server scr1wgpt:<span class="hljs-number">3000</span>;<br>    &#125;<br><br>    server &#123;<br>        listen <span class="hljs-number">80</span>;<br><br>        location / &#123;<br>            proxy_pass http://web_backend;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /chat &#123;<br>            proxy_pass http://chat_backend/<span class="hljs-comment">#/chat;</span><br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /_next &#123;<br>            proxy_pass http://chat_backend$request_uri;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /serviceWorkerRegister.js &#123;<br>            proxy_pass http://chat_backend/serviceWorkerRegister.js;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /site.webmanifest &#123;<br>            proxy_pass http://chat_backend/site.webmanifest;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /serviceWorker.js &#123;<br>            proxy_pass http://chat_backend/serviceWorker.js;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /favicon.ico &#123;<br>            proxy_pass http://chat_backend/favicon.ico;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /api &#123;<br>            proxy_pass http://chat_backend$request_uri;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /prompts.json &#123;<br>            proxy_pass http://chat_backend/prompts.json;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br><br>        location /google-fonts &#123;<br>            proxy_pass http://chat_backend$request_uri;<br>            proxy_set_header Host $host;<br>            proxy_set_header X-Real-IP $remote_addr;<br>            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>            proxy_set_header X-Forwarded-Proto $scheme;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>这样基本上就完成了</p>
<h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">version: <span class="hljs-string">&#x27;3&#x27;</span><br>services:<br>  scr1wgpt-web:<br>    build: .<br>    restart: always<br>    command: python /app/app.py<br>    env_file:<br>      - .<span class="hljs-keyword">env</span><br>    environment:<br>      - FLAG=$&#123;FLAG&#125;<br>    depends_on:<br>      - scr1wgpt-mysql<br><br>  scr1wgpt-mysql:<br>    build:<br>      context: .<br>      dockerfile: SQLDockerfile<br>    restart: always<br>    command: mysqld --character-set-server=utf8 --collation-server=utf8_unicode_ci --default-authentication-plugin=mysql_native_password<br>    environment:<br>      - MYSQL_ROOT_PASSWORD=sssctf2024_rootpassword<br><br>  scr1wgpt:<br>    image: shiraikuroko/gpt<br>    dns:<br>      - <span class="hljs-number">202.118</span>.<span class="hljs-number">66.6</span><br>    environment:<br>      - OPENAI_API_KEY=sk-xxx<br>      - BASE_URL=https://api.chatanywhere.tech<br>      - CODE=sssctf2024<br><br>  scr1wgpt-nginx:<br>    image: zedsich/scr1wgpt-nginx:latest<br>    volumes:<br>      - ./nginx.conf:/etc/nginx/conf.d/nginx.conf<br>    depends_on:<br>      - scr1wgpt-web<br>      - scr1wgpt<br>    ports:<br>        - <span class="hljs-string">&quot;9999:80&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h2><p><a target="_blank" rel="noopener" href="https://github.com/Zedsich/CTFd-docker-compose-template">github</a></p>
<p><a target="_blank" rel="noopener" href="https://dlut-sss.feishu.cn/wiki/Gn9UwUuNaiKLeLkv56ycQH3NnQd">wp</a></p>
<div id="paginator"></div></div><div id="post-footer"><div id="pages" style="justify-content: flex-end"><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2023/11/15/FreeBSD-ctags/">FreeBSD-ctags Prev →</a></div></div></div><details id="reward"><summary>reward</summary><div><span>Alipay</span><br><img src="/img/Alipay.png"></div><div><span>Wechat</span><br><img src="/img/WeChat.png"></div></details><div id="comments"><div class="selector"><button class="valine-sel"></button></div><div id="valine"></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="To Catalog">≡</a><a id="color-mode" onClick="colorMode.change()" title="Change Theme"></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Zedsich</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CTFd-%E5%A4%9A%E6%9C%8D%E5%8A%A1-WEB-dynamic-docker-compose-task%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">CTFd 多服务 WEB dynamic docker compose task实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ENV"><span class="toc-number">1.2.</span> <span class="toc-text">ENV</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementation"><span class="toc-number">1.3.</span> <span class="toc-text">Implementation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8nginx"><span class="toc-number">1.3.1.</span> <span class="toc-text">为什么要使用nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scr1wgpt"><span class="toc-number">1.3.2.</span> <span class="toc-text">scr1wgpt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scr1wgpt-web"><span class="toc-number">1.3.3.</span> <span class="toc-text">scr1wgpt-web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scr1wgpt-mysql"><span class="toc-number">1.3.4.</span> <span class="toc-text">scr1wgpt-mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scr1wgpt-nginx"><span class="toc-number">1.3.5.</span> <span class="toc-text">scr1wgpt-nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose"><span class="toc-number">1.3.6.</span> <span class="toc-text">docker-compose</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Link"><span class="toc-number">1.4.</span> <span class="toc-text">Link</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{new Valine({
 el: '#valine'
 , appId: '12mmdjDQr3Zp2ZAH5T8u420K-gzGzoHsz'
 , appKey: 'B6NVCNzhi3ZWtXN73NUXFT3D' , placeholder: 'This comment is sent by Penguin Logistics.'
 , path: window.location.pathname
});code.findCode();}</script><script src="/js/arknights.js"></script><script src="/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>